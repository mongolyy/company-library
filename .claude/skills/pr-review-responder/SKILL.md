---
name: pr-review-responder
description: >
  GitHub PRのレビューコメントに対して自動でコード修正を行うスキル。
  PR作成者が🚀リアクションをつけたレビューコメントを検出し、各コメントの指摘内容に対応するコード修正を行い、自動コミットする。
  以下の場合に使用する：
  (1) PRレビューコメントへの対応を依頼された時
  (2) 「レビュー対応」「レビューコメント対応」「PR対応」と言われた時
  (3) 🚀リアクションがついたコメントへの対応を求められた時
---

# PR Review Responder

GitHub PRのレビューコメント（🚀リアクション付き）に対してコード修正を行い、自動コミットする。

## ワークフロー

### 1. PR情報の取得

現在のブランチに紐づくPRを特定する。

```bash
# 現在のブランチのPR番号を取得
gh pr view --json number,author -q '.number'
```

### 2. 🚀リアクション付きコメントの取得

PR作成者自身が🚀リアクションをつけたレビューコメントを抽出する。

```bash
# PRのレビューコメント一覧を取得（ファイルパス・行番号・本文・リアクション含む）
gh api repos/{owner}/{repo}/pulls/{pr_number}/comments --paginate -q '.[] | {id, path, line, body, reactions: .reactions}'
```

各コメントについて、🚀リアクションの有無を確認する。

```bash
# コメントのリアクション詳細を取得し、PR作成者による🚀リアクションを確認
gh api repos/{owner}/{repo}/pulls/comments/{comment_id}/reactions -q '.[] | select(.content == "rocket") | .user.login'
```

### 3. コメントの対応

🚀リアクションがついたコメントを1つずつ処理する：

1. コメントの `path`（対象ファイル）と `line`（対象行）を確認
2. 該当ファイルの該当箇所を読む
3. コメントの指摘内容を理解し、適切なコード修正を行う
4. 修正内容が正しいことを確認

**対応順序**: ファイルごとにグループ化し、同一ファイルへの複数コメントはまとめて対応する。

### 4. コミット

すべてのコメント対応が完了したら、変更をコミットする。

- コミットメッセージに対応したレビューコメントの概要を含める
- 形式: `fix: レビューコメント対応`（本文に各コメントの対応内容を記載）

### 5. チェック実行

プロジェクトのAGENTS.mdやCLAUDE.mdに記載されたチェックコマンド（lint、typecheck、test等）を実行し、修正が問題ないことを確認する。

## 注意事項

- 対応不要なコメント（質問のみ、議論中など）にも🚀がついている場合は、コード修正せずスキップしてユーザーに報告する
- 大規模なリファクタリングが必要なコメントは、対応方針をユーザーに確認してから実施する
- コメントの意図が不明な場合は、ユーザーに確認する